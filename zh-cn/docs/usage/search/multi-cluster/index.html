<!doctype html><html lang=zh-cn class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.91.2">
<meta name=robots content="index, follow">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>多集群检索 | Clusterpedia.io</title>
<meta name=description content="多集群资源检索可以满足我们根据查询条件一次过滤多个集群内的资源，并提供对这些资源的分页排序的能力
在使用 kubectl 操作时，可以查看一下当前可以检索哪些资源
kubectl --cluster clusterpedia api-resources
# 输出：
NAME …">
<meta property="og:title" content="多集群检索">
<meta property="og:description" content="多集群资源检索可以满足我们根据查询条件一次过滤多个集群内的资源，并提供对这些资源的分页排序的能力
在使用 kubectl 操作时，可以查看一下当前可以检索哪些资源
kubectl --cluster clusterpedia api-resources # 输出： NAME SHORTNAMES APIVERSION NAMESPACED KIND configmaps cm v1 true ConfigMap namespaces ns v1 false Namespace nodes no v1 false Node pods po v1 true Pod secrets v1 true Secret daemonsets ds apps/v1 true DaemonSet deployments deploy apps/v1 true Deployment replicasets rs apps/v1 true ReplicaSet issuers cert-manager.io/v1 true Issuer Clusterpedia 根据所有集群同步的资源来提供多集群的资源检索，可以查看 同步集群资源 来更新需要同步的资源
基本功能 指定集群 多集群检索时，会默认检索所有的集群，我们也可以指定单个或者一组集群
kubectl URL 使用 Search Label search.">
<meta property="og:type" content="article">
<meta property="og:url" content="/zh-cn/docs/usage/search/multi-cluster/"><meta property="article:section" content="docs">
<meta property="og:site_name" content="Clusterpedia.io">
<meta itemprop=name content="多集群检索">
<meta itemprop=description content="多集群资源检索可以满足我们根据查询条件一次过滤多个集群内的资源，并提供对这些资源的分页排序的能力
在使用 kubectl 操作时，可以查看一下当前可以检索哪些资源
kubectl --cluster clusterpedia api-resources # 输出： NAME SHORTNAMES APIVERSION NAMESPACED KIND configmaps cm v1 true ConfigMap namespaces ns v1 false Namespace nodes no v1 false Node pods po v1 true Pod secrets v1 true Secret daemonsets ds apps/v1 true DaemonSet deployments deploy apps/v1 true Deployment replicasets rs apps/v1 true ReplicaSet issuers cert-manager.io/v1 true Issuer Clusterpedia 根据所有集群同步的资源来提供多集群的资源检索，可以查看 同步集群资源 来更新需要同步的资源
基本功能 指定集群 多集群检索时，会默认检索所有的集群，我们也可以指定单个或者一组集群
kubectl URL 使用 Search Label search.">
<meta itemprop=wordCount content="895">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="多集群检索">
<meta name=twitter:description content="多集群资源检索可以满足我们根据查询条件一次过滤多个集群内的资源，并提供对这些资源的分页排序的能力
在使用 kubectl 操作时，可以查看一下当前可以检索哪些资源
kubectl --cluster clusterpedia api-resources # 输出： NAME SHORTNAMES APIVERSION NAMESPACED KIND configmaps cm v1 true ConfigMap namespaces ns v1 false Namespace nodes no v1 false Node pods po v1 true Pod secrets v1 true Secret daemonsets ds apps/v1 true DaemonSet deployments deploy apps/v1 true Deployment replicasets rs apps/v1 true ReplicaSet issuers cert-manager.io/v1 true Issuer Clusterpedia 根据所有集群同步的资源来提供多集群的资源检索，可以查看 同步集群资源 来更新需要同步的资源
基本功能 指定集群 多集群检索时，会默认检索所有的集群，我们也可以指定单个或者一组集群
kubectl URL 使用 Search Label search.">
<link rel=preload href=/scss/main.min.9961c751547efda0481dd5723ad2db290629eb1181b4dd88454b106a6737233e.css as=style>
<link href=/scss/main.min.9961c751547efda0481dd5723ad2db290629eb1181b4dd88454b106a6737233e.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link href=https://cdn.bootcdn.net/ajax/libs/asciinema-player/2.6.1/asciinema-player.min.css rel=stylesheet>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZQPMJ4HH3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NZQPMJ4HH3',{anonymize_ip:!1})}</script>
</head>
<body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/zh-cn/>
<span class=navbar-logo><svg id="Graph" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g id="Cpedia_-_Graph_-_Color_Dark" data-name="Cpedia - Graph - Color Dark"><rect id="Frame" width="512" height="512" fill="none"/><path id="Secondary" d="M476 221.051A274.908 274.908.0 00428.269 256 282.438 282.438.0 01395.7 220.752a322.971 322.971.0 0156.3-41.27zM362.4 256a334.139 334.139.0 00-53.2 92.145A329.953 329.953.0 00295.32 394.6a322.932 322.932.0 00-7.587 69.4h48a274.957 274.957.0 016.4-58.813 282.32 282.32.0 0114.238-45.835 285.94 285.94.0 0139.323-68.1A330.2 330.2.0 01362.4 256zM169.865 405.189a274.9 274.9.0 016.4 58.811h48a322.893 322.893.0 00-7.589-69.4 282.46 282.46.0 00-46.811 10.589zM179.94 300.03A333.961 333.961.0 00149.6 256a330 330 0 00-33.291-35.248A322.915 322.915.0 0060 179.482L36 221.051A274.964 274.964.0 0183.733 256a282.3 282.3.0 0132.576 35.248 286.331 286.331.0 0122.054 32.768 286.3 286.3.0 0117.264 35.339A330.144 330.144.0 01202.8 348.148 334.156 334.156.0 00179.94 300.03zM169.865 106.811a274.966 274.966.0 01-54.132-23.862l-24 41.569a322.934 322.934.0 0063.894 28.127 282.241 282.241.0 0014.238-45.834zm186.507 45.836a322.994 322.994.0 0063.895-28.129l-24-41.569a275.02 275.02.0 01-54.133 23.864A282.293 282.293.0 01295.32 117.4a286.278 286.278.0 01-39.307 2.716h-.1a286.366 286.366.0 01-39.237-2.718 330.245 330.245.0 01-13.88 46.455 334.129 334.129.0 0053.1 4.263h.115a333.931 333.931.0 0053.187-4.261 329.92 329.92.0 0047.174-11.208z" fill="#1b1c1d"/><path id="Primary" d="M211.993 256l22-38.1h44l22 38.1-22 38.105h-44zM342.134 106.813A274.957 274.957.0 01335.733 48h-48a322.932 322.932.0 007.587 69.4 282.293 282.293.0 0046.814-10.587zM428.269 256A282.438 282.438.0 01395.7 220.752a285.92 285.92.0 01-39.323-68.105A329.92 329.92.0 01309.2 163.854 334.125 334.125.0 00362.4 256a330.2 330.2.0 0033.3 35.248 322.971 322.971.0 0056.3 41.27l24-41.569A274.908 274.908.0 01428.269 256zM149.6 256a333.961 333.961.0 0030.34-44.03 334.156 334.156.0 0022.86-48.118 330.245 330.245.0 0013.88-46.455A322.893 322.893.0 00224.267 48h-48a274.9 274.9.0 01-6.4 58.811 282.241 282.241.0 01-14.238 45.834 286.3 286.3.0 01-17.264 35.339 286.331 286.331.0 01-22.054 32.768A330 330 0 01149.6 256zm-65.867.0A274.964 274.964.0 0136 290.949l24 41.569a322.915 322.915.0 0056.309-41.27A282.3 282.3.0 0083.733 256zM255.9 343.885a334.129 334.129.0 00-53.1 4.263 330.144 330.144.0 00-47.171 11.207 322.934 322.934.0 00-63.894 28.127l24 41.569a274.966 274.966.0 0154.132-23.862A282.46 282.46.0 01216.678 394.6a286.366 286.366.0 0139.237-2.718h.1A286.278 286.278.0 01295.32 394.6a329.953 329.953.0 0113.88-46.456 334.028 334.028.0 00-53.187-4.26zm86.236 61.3a275.027 275.027.0 0154.133 23.864l24-41.569a322.991 322.991.0 00-63.895-28.13 282.32 282.32.0 00-14.24 45.837z" fill="#33de72"/></g></svg></span><span class=font-weight-bold>Clusterpedia.io</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/zh-cn/about/><span>关于</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/zh-cn/blog/><i class="fas fa-blog"></i><span>博客</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/zh-cn/docs/><i class="fas fa-book"></i><span class=active>文档</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=https://github.com/clusterpedia-io/clusterpedia target=_blank><i class="fab fa-github"></i><span>GitHub</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=https://join.slack.com/t/clusterpedia/shared_invite/zt-11smmdntu-Im1YjOahqvHhJFqNzLELOA target=_blank><i class="fab fa-slack"></i><span>Slack</span></a>
</li>
<li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
中文 Chinese
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/docs/usage/search/multi-cluster/>English</a>
</div>
</li>
</ul>
</div>
<div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off data-offline-search-index-json-src=/offline-search-index.31e99c91fa6517c59590c2cc91a66e99.json data-offline-search-base-href=/ data-offline-search-max-results=10>
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id=td-sidebar-menu class=td-sidebar__inner>
<form class="td-sidebar__search d-flex align-items-center">
<input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off data-offline-search-index-json-src=/offline-search-index.31e99c91fa6517c59590c2cc91a66e99.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation">
</button>
</form>
<nav class="collapse td-sidebar-nav" id=td-section-nav>
<div class="nav-item dropdown d-block d-lg-none">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
中文 Chinese
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/docs/usage/search/multi-cluster/>English</a>
</div>
</div>
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zh-cndocs-li>
<a href=/zh-cn/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-zh-cndocs><span>文档</span></a>
<ul class=ul-1>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zh-cndocsinstallation-li>
<a href=/zh-cn/docs/installation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zh-cndocsinstallation><span>安装</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsinstallationkubectl-apply-li>
<a href=/zh-cn/docs/installation/kubectl-apply/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsinstallationkubectl-apply><span>使用 kubectl apply</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsinstallationhelm-li>
<a href=/zh-cn/docs/installation/helm/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsinstallationhelm><span>使用 Helm</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zh-cndocsinstallationconfigurate-li>
<a href=/zh-cn/docs/installation/configurate/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zh-cndocsinstallationconfigurate><span>配置</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsinstallationconfigurateconfigurate-internalstorage-li>
<a href=/zh-cn/docs/installation/configurate/configurate-internalstorage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsinstallationconfigurateconfigurate-internalstorage><span>配置存储层</span></a>
</li>
</ul>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zh-cndocsconcepts-li>
<a href=/zh-cn/docs/concepts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zh-cndocsconcepts><span>概念</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsconceptscollection-resource-li>
<a href=/zh-cn/docs/concepts/collection-resource/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsconceptscollection-resource><span>聚合资源(Collection Resource)</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsconceptspediacluster-li>
<a href=/zh-cn/docs/concepts/pediacluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsconceptspediacluster><span>PediaCluster</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zh-cndocsusage-li>
<a href=/zh-cn/docs/usage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zh-cndocsusage><span>使用</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsusageimport-clusters-li>
<a href=/zh-cn/docs/usage/import-clusters/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsusageimport-clusters><span>集群接入</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsusagesync-resources-li>
<a href=/zh-cn/docs/usage/sync-resources/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsusagesync-resources><span>同步集群资源</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsusageaccess-clusterpedia-li>
<a href=/zh-cn/docs/usage/access-clusterpedia/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsusageaccess-clusterpedia><span>访问 Clusterpedia</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zh-cndocsusagesearch-li>
<a href=/zh-cn/docs/usage/search/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zh-cndocsusagesearch><span>资源检索</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-zh-cndocsusagesearchmulti-cluster-li>
<a href=/zh-cn/docs/usage/search/multi-cluster/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsusagesearchmulti-cluster><span class=td-sidebar-nav-active-item>多集群检索</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsusagesearchspecified-cluster-li>
<a href=/zh-cn/docs/usage/search/specified-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsusagesearchspecified-cluster><span>指定集群检索</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsusagesearchcollection-resource-li>
<a href=/zh-cn/docs/usage/search/collection-resource/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsusagesearchcollection-resource><span>聚合资源检索</span></a>
</li>
</ul>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zh-cndocsfeatures-li>
<a href=/zh-cn/docs/features/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zh-cndocsfeatures><span>特性功能</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsfeaturesremaining_item_count-li>
<a href=/zh-cn/docs/features/remaining_item_count/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsfeaturesremaining_item_count><span>返回剩余资源数量</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsfeaturesraw_sql_query-li>
<a href=/zh-cn/docs/features/raw_sql_query/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsfeaturesraw_sql_query><span>原生 SQL 查询</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsfeaturesprune_fields-li>
<a href=/zh-cn/docs/features/prune_fields/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsfeaturesprune_fields><span>资源字段裁剪</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsfeaturessync_all_custom_resources-li>
<a href=/zh-cn/docs/features/sync_all_custom_resources/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsfeaturessync_all_custom_resources><span>同步所有的自定义资源</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsfeaturessync_all_resources-li>
<a href=/zh-cn/docs/features/sync_all_resources/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zh-cndocsfeaturessync_all_resources><span>同步所有的资源</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zh-cndocsrelease-notes-li>
<a href=https://github.com/clusterpedia-io/clusterpedia/releases class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zh-cndocsrelease-notes><span>版本日志</span></a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
<aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href=https://github.com/clusterpedia-io/website/tree/main/content/zh-cn/docs/usage/search/multi-cluster.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> 查看页面源码</a>
<a href=https://github.com/clusterpedia-io/website/edit/main/content/zh-cn/docs/usage/search/multi-cluster.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/clusterpedia-io/website/new/main/content/zh-cn/docs/usage/search/multi-cluster.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/clusterpedia-io/website/issues/new?title=%e5%a4%9a%e9%9b%86%e7%be%a4%e6%a3%80%e7%b4%a2" class=td-page-meta--issue target=_blank rel=noopener><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/clusterpedia-io/website/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a>
<a id=print href=/zh-cn/docs/usage/search/_print/><i class="fa fa-print fa-fw"></i> 整节打印</a>
</div>
<div class=td-toc><nav id=TableOfContents>
<ul>
<li><a href=#基本功能>基本功能</a>
<ul>
<li><a href=#指定集群>指定集群</a></li>
<li><a href=#指定命名空间>指定命名空间</a></li>
<li><a href=#指定资源名称>指定资源名称</a></li>
<li><a href=#创建时间的区间>创建时间的区间</a></li>
</ul>
</li>
<li><a href=#模糊搜索>模糊搜索</a></li>
<li><a href=#字段过滤>字段过滤</a>
<ul>
<li><a href=#列表字段支持>列表字段支持</a></li>
</ul>
</li>
<li><a href=#根据父辈以及祖辈-owner-查询>根据父辈以及祖辈 Owner 查询</a></li>
<li><a href=#分页与排序>分页与排序</a>
<ul>
<li><a href=#根据多个字段进行排序>根据多个字段进行排序</a></li>
<li><a href=#分页>分页</a></li>
<li><a href=#响应携带-continue-信息>响应携带 Continue 信息</a></li>
<li><a href=#响应携带剩余资源数量信息>响应携带剩余资源数量信息</a></li>
</ul>
</li>
</ul>
</nav></div>
</aside>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<nav aria-label=breadcrumb class=td-breadcrumbs>
<ol class=breadcrumb>
<li class=breadcrumb-item>
<a href=/zh-cn/docs/>文档</a>
</li>
<li class=breadcrumb-item>
<a href=/zh-cn/docs/usage/>使用</a>
</li>
<li class=breadcrumb-item>
<a href=/zh-cn/docs/usage/search/>资源检索</a>
</li>
<li class="breadcrumb-item active" aria-current=page>
<a href=/zh-cn/docs/usage/search/multi-cluster/>多集群检索</a>
</li>
</ol>
</nav>
<div class=td-content>
<h1>多集群检索</h1>
<header class=article-meta>
<p class=reading-time><i class="fa fa-clock" aria-hidden=true></i>&nbsp; 5 分钟阅读 &nbsp;</p>
</header>
<p>多集群资源检索可以满足我们<strong>根据查询条件一次过滤多个集群内的资源，并提供对这些资源的分页排序的能力</strong></p>
<p>在使用 kubectl 操作时，可以查看一下当前可以检索哪些资源</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia api-resources
</code></pre></div><pre tabindex=0><code># 输出：
NAME          SHORTNAMES   APIVERSION           NAMESPACED   KIND
configmaps    cm           v1                   true         ConfigMap
namespaces    ns           v1                   false        Namespace
nodes         no           v1                   false        Node
pods          po           v1                   true         Pod
secrets                    v1                   true         Secret
daemonsets    ds           apps/v1              true         DaemonSet
deployments   deploy       apps/v1              true         Deployment
replicasets   rs           apps/v1              true         ReplicaSet
issuers                    cert-manager.io/v1   true         Issuer
</code></pre><p>Clusterpedia 根据所有集群同步的资源来提供多集群的资源检索，可以查看 <a href=../../sync-resources>同步集群资源</a> 来更新需要同步的资源</p>
<h2 id=基本功能>基本功能</h2>
<h3 id=指定集群>指定集群</h3>
<p>多集群检索时，会默认检索所有的集群，我们也可以指定单个或者一组集群</p>
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-1 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-1-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-1-0 aria-selected=true>kubectl</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-1-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-1-1>URL</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-1><div id=tabset-zh-cndocsusagesearchmulti-cluster-1-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-1-0>
<p><p>使用 <a href=../#%E5%85%83%E4%BF%A1%E6%81%AF%E6%A3%80%E7%B4%A2>Search Label</a> <code>search.clusterpedia.io/clusters</code> 来指定一组集群</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deployments -l <span style=color:#4e9a06>&#34;search.clusterpedia.io/clusters in (cluster-1,cluster-2)&#34;</span>
</code></pre></div><pre tabindex=0><code># 输出：
NAMESPACE     CLUSTER     NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   cluster-1   coredns                   2/2     2            2           68d
kube-system   cluster-2   coredns                   2/2     2            2           64d
</code></pre><p>对于指定单个集群的检索，同样可以使用 Search Label 来设置，也可以查看 <a href=../specified-cluster>指定集群检索</a> 来使用 URL Path 的方式指定集群</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8f5902;font-style:italic># 指定单个集群</span>
kubectl --cluster clusterpedia get deployments -l <span style=color:#4e9a06>&#34;search.clusterpedia.io/clusters=cluster-1&#34;</span>

<span style=color:#8f5902;font-style:italic># 指定集群也可以使用 --cluster &lt;cluster name&gt; 来指定</span>
kubectl --cluster cluster-1 get deployments
</code></pre></div></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-1-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-1-1>
<p><p>使用 URL 时，使用 <code>clusters</code> 作为 <a href=../#%E5%85%83%E4%BF%A1%E6%81%AF%E6%A3%80%E7%B4%A2>URL Query</a> 来传递</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?clusters=cluster-1&#34;</span>
</code></pre></div><p>如果指定单个集群，也可以将 cluster name 放到 URL 路径中</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/clusters/cluster-1/apis/apps/v1/deployments&#34;</span>
</code></pre></div><p>了解更多<a href=../specified-cluster>指定集群检索</a></p>
</div></div>
<h3 id=指定命名空间>指定命名空间</h3>
<p>可以像查看原生 Kube 一样来<strong>指定单个命名空间或者所有命名空间</strong></p>
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-2 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-2-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-2-0 aria-selected=true>kubectl</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-2-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-2-1>URL</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-2><div id=tabset-zh-cndocsusagesearchmulti-cluster-2-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-2-0>
<p><p>使用 <code>-n &lt;namespace></code> 来指定命名空间，默认在 <em>default</em> 命名空间</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deployments -n kube-system
</code></pre></div><pre tabindex=0><code># 输出：
CLUSTER     NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
cluster-1   coredns                   2/2     2            2           68d
cluster-2   calico-kube-controllers   1/1     1            1           64d
cluster-2   coredns                   2/2     2            2           64d
</code></pre><p>使用 <code>-A</code> 或者 <code>--all-namespaces</code> 来查看所有集群的所有命名空间下的资源</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deployments -A
</code></pre></div><pre tabindex=0><code># 输出：
NAMESPACE     CLUSTER     NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   cluster-1   coredns                   2/2     2            2           68d
kube-system   cluster-2   calico-kube-controllers   1/1     1            1           64d
kube-system   cluster-2   coredns                   2/2     2            2           64d
default       cluster-2   dd-airflow-scheduler      0/1     1            0           54d
default       cluster-2   dd-airflow-web            0/1     1            0           54d
</code></pre></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-2-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-2-1>
<p><p>获取资源的 <strong>URL Path</strong> 和原生 Kubernetes 一样 <em>/apis/apps/v1/deployments</em>，</p>
<p>只是需要加上 Clusterpedia Resources 的路径前缀 <em>/apis/clusterpedia.io/v1beta1/resources</em> 来表示当前是 Clusterpedia 请求。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments&#34;</span>

<span style=color:#8f5902;font-style:italic># 指定命名空间</span>
kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/namespaces/kube-system/deployments&#34;</span>
</code></pre></div></div></div>
<hr>
<p>除了指定单个命名空间，还可以<strong>指定查看一组命名空间下的资源</strong>
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-3 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-3-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-3-0 aria-selected=true>kubectl</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-3-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-3-1>URL</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-3><div id=tabset-zh-cndocsusagesearchmulti-cluster-3-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-3-0>
<p><p>使用 <a href=../#%E5%85%83%E4%BF%A1%E6%81%AF%E6%A3%80%E7%B4%A2>Search Label</a> <code>search.clusterpedia.io/namespaces</code> 来指定一组命名空间</p>
<blockquote>
<p>一定要指定 -A 参数，避免 kubectl 在路径中设置 default namespace</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deployments -A -l <span style=color:#4e9a06>&#34;search.clusterpedia.io/namespaces in (kube-system, default)&#34;</span>
</code></pre></div><pre tabindex=0><code># 输出：
NAMESPACE     CLUSTER     NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   cluster-1   coredns                   2/2     2            2           68d
kube-system   cluster-2   calico-kube-controllers   1/1     1            1           64d
kube-system   cluster-2   coredns                   2/2     2            2           64d
default       cluster-2   dd-airflow-scheduler      0/1     1            0           54d
default       cluster-2   dd-airflow-web            0/1     1            0           54d
</code></pre></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-3-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-3-1>
<p><p>使用 URL 时，就不需要使用 Label Selector 来传递参数了，直接使用 URL Query <code>namespaces</code> 即可</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?namespaces=kube-system,default&#34;</span>
</code></pre></div></div></div>
</p>
<h3 id=指定资源名称>指定资源名称</h3>
<p>用户可以通过一组资源名称来过滤资源</p>
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-4 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-4-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-4-0 aria-selected=true>kubectl</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-4-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-4-1>URL</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-4><div id=tabset-zh-cndocsusagesearchmulti-cluster-4-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-4-0>
<p><p>使用 Search Label <code>search.clusterpedia.io/names</code> 来指定一组资源名称
<strong>注意：如果在所有命名空间下检索资源，需要指定 -A 参数，或者使用 -n 来指定命名空间</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deployments -A -l <span style=color:#4e9a06>&#34;search.clusterpedia.io/names=coredns&#34;</span>
</code></pre></div><pre tabindex=0><code># 输出：
NAMESPACE     CLUSTER     NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   cluster-1   coredns                   2/2     2            2           68d
kube-system   cluster-2   coredns                   2/2     2            2           64d
</code></pre></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-4-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-4-1>
<p><p>使用 URL 时，使用 <code>names</code> 作为 URL Query 来传递，如果需要指定命名空间，那么就在路径中加上 namespace。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?names=kube-coredns,dd-airflow-web&#34;</span>

<span style=color:#8f5902;font-style:italic># 在 default 命名空间下检索指定名字的资源</span>
kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/namespaces/default/deployments?names=kube-coredns,dd-airflow-web&#34;</span>
</code></pre></div><p>在多集群检索时，返回的数据实际是以类似 <code>DeploymentList</code> 的结构封装的数据。</p>
<p>如果我们想要获取到单个的 <code>Deployment</code> 那么就需要在 URL 路径中指定 cluster name，参考<a href=../specified-cluster#%E8%8E%B7%E5%8F%96%E5%8D%95%E4%B8%AA%E8%B5%84%E6%BA%90>获取单个资源</a></p>
</div></div>
<h3 id=创建时间的区间>创建时间的区间</h3>
<p>创建时间的区间以左闭右开的方式来进行检索，<strong>since &lt;= creation time &lt; before</strong></p>
<p>关于详细的时间区间参数可以查看 <a href=../#%E5%88%9B%E5%BB%BA%E6%97%B6%E9%97%B4%E5%8C%BA%E9%97%B4%E6%A3%80%E7%B4%A2>创建时间区间检索</a></p>
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-5 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-5-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-5-0 aria-selected=true>kubectl</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-5-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-5-1>URL</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-5><div id=tabset-zh-cndocsusagesearchmulti-cluster-5-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-5-0>
<p><p>使用 Search Label <code>search.clusterpedia.io/since</code> 和 <code>search.clusterpedia.io/before</code> 来指定时间区间</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deployments -A -l <span style=color:#4e9a06>&#34;search.clusterpedia.io/since=2022-03-24, \
</span><span style=color:#4e9a06>    search.clusterpedia.io/before=2022-04-10&#34;</span>
</code></pre></div></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-5-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-5-1>
<p><p>直接使用 URL 时，可以 Query <code>since</code> 和 <code>before</code> 来分别指定时间的区间</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?since=2022-03-24&amp;before=2022-04-10&#34;</span>
</code></pre></div></div></div>
<h2 id=模糊搜索>模糊搜索</h2>
<p>当前支持根据资源名称进行模糊搜索，由于模糊搜索还需要继续讨论，所以暂时以试验性功能来提供</p>
<p>只支持 Search Label 的方式，不支持 URL Query</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deployments -A -l <span style=color:#4e9a06>&#34;internalstorage.clusterpedia.io/fuzzy-name=test&#34;</span>
</code></pre></div><p>过滤出名字中包含 <em>test</em> 字符串的 deployments。</p>
<p>可以使用 <code>in</code> 操作符来传递多个参数，这样可以过滤出名字中包含所有字符串的资源</p>
<h2 id=字段过滤>字段过滤</h2>
<p>原生 Kubernetes 当前只支持对 <code>metadata.name</code> 和 <code>metadata.namespace</code> 的字段过滤，而且操作符只支持 <code>=</code>，<code>!=</code>，<code>==</code>，能力非常有限。</p>
<p><strong>Clusterpedia 在兼容已有的 Field Selector 功能的基础上，提供了更加强大的功能，支持和 <code>Label Selector</code> 相同的操作符。</strong></p>
<p>Field Selector 的 key 当前支持三种格式：</p>
<ul>
<li><strong>使用 <code>.</code> 分隔字段</strong></li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get pods --field-selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;status.phase=Running&#34;</span>

<span style=color:#8f5902;font-style:italic># 也可以在首字符添加 `.`</span>
kubectl --cluster clusterpedia get pods --field-selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;.status.phase notin (Running,Succeeded)&#34;</span>
</code></pre></div><ul>
<li><strong>字段名称使用 <code>''</code> 或者 <code>""</code> 来包裹</strong>，可以用于带 <code>.</code> 之类的非法字符的字段</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deploy <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --field-selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;metadata.annotations[&#39;test.io&#39;] in (value1,value2),spec.replica=3&#34;</span>
</code></pre></div><ul>
<li><strong>使用 <code>[]</code> 来分隔字段</strong>，<code>[]</code> 内字符串必须使用 <code>''</code> 或者 <code>""</code> 来包裹</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get pods --field-selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;status[&#39;phase&#39;]!=Running&#34;</span>
</code></pre></div><h3 id=列表字段支持>列表字段支持</h3>
<p>实际在字段过滤的设计时考虑到了对<code>列表元素</code>内字段过滤，不过由于使用场景是否真正有意义还需要更多的讨论 <a href=https://github.com/clusterpedia-io/clusterpedia/issues/48>issue: support list field filtering</a></p>
<p>示例：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get po --field-selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;spec.containers[].name!=container1&#34;</span>

kubectl get po --field-selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;spec.containers[].name == container1&#34;</span>

kubectl get po --field-selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;spec.containers[1].name in (container1,container2)&#34;</span>
</code></pre></div><h2 id=根据父辈以及祖辈-owner-查询>根据父辈以及祖辈 Owner 查询</h2>
<p>通过 Owner 检索是一个非常有用的检索功能，
并且 Clusterpedia 在 Owner 的基础上还支持<strong>对 Owner 进行辈分提升来进行祖辈甚至更高辈分的检索</strong>。</p>
<p>通过 Owner 检索，可以一次查询到 <code>Deployment</code> 下的所有 <code>Pods</code>，无需中间再查询 <code>ReplicaSet</code>。</p>
<p><strong>Owner 查询必须指定单个集群，可以使用 <a href=../#owner-%E6%A3%80%E7%B4%A2>Serach Label</a> 或者 <a href=../#owner-%E6%A3%80%E7%B4%A2>URL Query</a> 来指定，也可以在 URL Path 中指定集群名称</strong></p>
<p>关于<strong>根据 Owner 检索</strong>的具体使用方法，可以参考<a href=../specified-cluster#%E6%A0%B9%E6%8D%AE%E7%88%B6%E8%BE%88%E6%88%96%E8%80%85%E7%A5%96%E8%BE%88-owner-%E8%BF%9B%E8%A1%8C%E6%A3%80%E7%B4%A2>指定集群内根据父辈或者祖辈 Owenr 进行检索</a></p>
<h2 id=分页与排序>分页与排序</h2>
<p>分页和排序是资源检索必不可少的功能</p>
<h3 id=根据多个字段进行排序>根据多个字段进行排序</h3>
<p>可以指定多个字段进行排序，而对排序字段的支持是由存储层来决定。</p>
<p>当前默认存储层支持对 <code>cluster</code>，<code>namespace</code>，<code>name</code>，<code>created_at</code>，<code>resource_version</code> 进行正序和倒序的排序，字段也支持随意的组合
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-6 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-6-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-6-0 aria-selected=true>kubectl</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-6-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-6-1>URL</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-6><div id=tabset-zh-cndocsusagesearchmulti-cluster-6-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-6-0>
<p><p>使用多个字段进行正序排序</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get pods -l <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    <span style=color:#4e9a06>&#34;search.clusterpedia.io/orderby in (cluster, name)&#34;</span>
</code></pre></div><p>由于 Label Selector 对 value 的限制，倒序时需要在字段结尾加上 <code>_desc</code></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get pods -l <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    <span style=color:#4e9a06>&#34;search.clusterpedia.io/orderby in (namespace_desc, cluster, name)&#34;</span>
</code></pre></div></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-6-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-6-1>
<p><p>使用 <a href=../#%E6%8E%92%E5%BA%8F>URL Query</a> 来指定排序字段</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?orderby=namespace,cluster&#34;</span>
</code></pre></div><p>指定倒序字段时，在字段后添加 desc，以空格分隔</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?orderby=namespace desc,cluster&#34;</span>
</code></pre></div></div></div>
</p>
<h3 id=分页>分页</h3>
<p>原生 Kubernetes 实际是支持分页的，<a href=https://pkg.go.dev/k8s.io/apimachinery/pkg/apis/meta/v1#ListOptions>ListOptions</a> 中便已经存在用于分页查询的字段。</p>
<p>Clusterpedia 复用 <code>ListOptions.Limit</code> 和 <code>ListOptions.Continue</code> 字段作为分页的 <code>size</code> 和 <code>offset</code>。</p>
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-7 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-7-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-7-0 aria-selected=true>kubectl</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-7-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-7-1>URL</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-7><div id=tabset-zh-cndocsusagesearchmulti-cluster-7-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-7-0>
<p><p>kubectl 的 <code>--chunk-size</code> 实际通过设置 <code>limit</code> 来用于分片拉取。</p>
<p>原生的 Kubernetes APIServer 会在返回的响应中携带用于下一次拉取的 <code>continue</code>，
并根据 <code>--chunk-size</code> 和 <code>conintue</code> 进行下一次拉取，直到相应的数据中 Conintue 为空。</p>
<p>Clusterpedia 为了保证在 kubectl 中实现分页检索，默认并不会在响应中返回 <code>continue</code> 字段，这样避免了 kubectl 使用分片拉取全部数据</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster cluster-1 get pods --chunk-size <span style=color:#0000cf;font-weight:700>10</span>
</code></pre></div><p>需要注意 kubectl 在不设置 <code>--chunk-size</code> 的情况下，<code>limit</code> 会被设置成默认值 <code>500</code>，
也就是说 <code>search.clusterpedia.io/size</code> 实际是无法生效的，只是用于和 <code>search.clusterpedia.io/offset</code> 形成对应关系</p>
<blockquote>
<p>URL Query 的优先级大于 Search Label</p>
</blockquote>
<p>在 kubectl 中 continue 是没有 flag 可以设置的。所以还是要使用 <a href=../#%E5%88%86%E9%A1%B5>Search Label</a> 来传递。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get pods --chunk-size <span style=color:#0000cf;font-weight:700>10</span> -l <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    <span style=color:#4e9a06>&#34;search.clusterpedia.io/offset=10&#34;</span>
</code></pre></div></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-7-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-7-1>
<p><p>对资源进行分页检索，只需要在 URL 中设置 <code>limit</code> 和 <code>continue</code> 即可</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?limit=10&amp;continue=5&#34;</span>
</code></pre></div></div></div>
<h3 id=响应携带-continue-信息>响应携带 Continue 信息</h3>
<p>响应数据的 <a href=https://pkg.go.dev/k8s.io/apimachinery/pkg/apis/meta/v1#ListMeta>ListMeta.Continue</a> 可以用于 <a href=https://pkg.go.dev/k8s.io/apimachinery/pkg/apis/meta/v1#ListOptions>ListOptions.Continue</a> 中作为下一次拉取的 offset</p>
<p>分页功能中我们提到，为了避免 kubectl 进行对全量数据的分片拉取，Clusterepdia 不会在响应中携带 Continue 信息。</p>
<p>不过如果用户有需求那么可以要求响应中携带 Continue 信息
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-8 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-8-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-8-0 aria-selected=true>URL</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-8-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-8-1>kubectl</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-8><div id=tabset-zh-cndocsusagesearchmulti-cluster-8-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-8-0>
<p><p>在使用 URL 访问 Clusterepdia 时，响应的 Continue 可以作为下一次请求的 offset</p>
<blockquote>
<p>搭配分页功能使用</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?withContinue=true&amp;limit=1&#34;</span> <span style=color:#000;font-weight:700>|</span> jq
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;DeploymentList&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#204a87;font-weight:700>&#34;apiVersion&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;apps/v1&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;continue&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;1&#34;</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#204a87;font-weight:700>&#34;items&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
    <span style=color:#a40000>...</span>
  <span style=color:#000;font-weight:700>]</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-8-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-8-1>
<p><p><strong>在 kubectl 设置 <code>search.clusterpedia.io/with-continue</code> 会导致以分片拉取的形式拉取全量资源。</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl --cluster clusterpedia get deploy -l <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    <span style=color:#4e9a06>&#34;search.clusterpedia.io/with-continue=true&#34;</span>
</code></pre></div></div></div>
</p>
<h3 id=响应携带剩余资源数量信息>响应携带剩余资源数量信息</h3>
<p><strong>在一些 UI 场景下，往往会需要获取到当前检索条件下的资源总量。</strong></p>
<p>Kubernetes List 响应的 <a href=https://pkg.go.dev/k8s.io/apimachinery/pkg/apis/meta/v1#ListMeta>ListMeta</a> 中存在 <code>RemainingItemCount</code> 字段，</p>
<p>通过复用该字段，便可在兼容 Kubernetes OpenAPI 的基础下计算出资源总量：</p>
<p><strong><code>offset + len(list.items) + list.metadata.remainingItemCount</code></strong></p>
<blockquote>
<p>在 offset 过大时，<code>remainingItemCount</code> 可能为负数，保证总是可以计算出资源总量</p>
</blockquote>
<ul class="nav nav-tabs" id=tabset-zh-cndocsusagesearchmulti-cluster-9 role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tabset-zh-cndocsusagesearchmulti-cluster-9-0 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-9-0 aria-selected=true>URL</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tabset-zh-cndocsusagesearchmulti-cluster-9-1 role=tab aria-controls=tabset-zh-cndocsusagesearchmulti-cluster-9-1>kubectl</a></li></ul>
<div class=tab-content id=tabset-zh-cndocsusagesearchmulti-cluster-9><div id=tabset-zh-cndocsusagesearchmulti-cluster-9-0 class="tab-pane show active" role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-9-0>
<p><p>在 <a href=../#%E5%88%86%E9%A1%B5>URL Query</a> 设置 <code>withRemainingCount</code> 即可要求响应携带剩余资源数量</p>
<blockquote>
<p>搭配<a href=#%E5%88%86%E9%A1%B5>分页</a>功能使用</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get --raw<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments?withRemainingCount&amp;limit=1&#34;</span> <span style=color:#000;font-weight:700>|</span> jq
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;DeploymentList&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#204a87;font-weight:700>&#34;apiVersion&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;apps/v1&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;remainingItemCount&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>23</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#204a87;font-weight:700>&#34;items&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
    <span style=color:#a40000>...</span>
  <span style=color:#000;font-weight:700>]</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div></div>
<div id=tabset-zh-cndocsusagesearchmulti-cluster-9-1 class=tab-pane role=tabpanel aria-labelledby=tabset-zh-cndocsusagesearchmulti-cluster-9-1>
<p><p>需要以 URL 的方式使用该功能</p>
</div></div>
<style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style>
<div class=d-print-none>
<h2 class=feedback--title>Feedback</h2>
<p class=feedback--question>Was this page helpful?</p>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
Glad to hear it! Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
Sorry to hear that. Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.
</p>
</div>
<script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script>
<br>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/clusterpedia-io aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack>
<a class=text-white target=_blank rel=noopener href=https://clusterpedia.slack.com aria-label=Slack>
<i class="fab fa-slack"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list">
<a class=text-white target=_blank rel=noopener href=mailto:clusterpedia@googlegroups.com aria-label="Developer mailing list">
<i class="fa fa-envelope"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 The Clusterpedia Authors 保留所有权利</small>
<p class=mt-2><a href=/zh-cn/about/>关于 Clusterpedia</a></p>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.8ab8f81ff7e1454d30024cd6f956d4d341c3a97e2a673f988065f2ee4e147922.js integrity="sha256-irj4H/fhRU0wAkzW+VbU00HDqX4qZz+YgGXy7k4UeSI=" crossorigin=anonymous></script>
<script src=https://cdn.bootcdn.net/ajax/libs/asciinema-player/2.6.1/asciinema-player.min.js></script>
</body>
</html>